

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>detectree2.models package &mdash; detectree2 1.0.8 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=aec50437"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            detectree2
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">2. Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_multi.html">3. Tutorial (multiclass)</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">4. Contributing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-git.html">5. Git/Github</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">detectree2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">detectree2.models package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/detectree2.models.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="detectree2-models-package">
<h1>detectree2.models package<a class="headerlink" href="#detectree2-models-package" title="Link to this heading"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading"></a></h2>
</section>
<section id="module-detectree2.models.evaluation">
<span id="detectree2-models-evaluation-module"></span><h2>detectree2.models.evaluation module<a class="headerlink" href="#module-detectree2.models.evaluation" title="Link to this heading"></a></h2>
<p>Evaluate model performance.</p>
<p>Classes and functions to evaluate model performances.</p>
<dl class="py class">
<dt class="sig sig-object py" id="detectree2.models.evaluation.Feature">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">Feature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">number</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lidar_filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lidar_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">EPSG</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.Feature" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Feature class to store.</p>
<p>Longer class information.</p>
<dl class="py method">
<dt class="sig sig-object py" id="detectree2.models.evaluation.Feature.get_tuple_coords">
<span class="sig-name descname"><span class="pre">get_tuple_coords</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coords</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.Feature.get_tuple_coords" title="Link to this definition"></a></dt>
<dd><p>Converts coordinates’ data structure from a list of lists to a list of tuples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="detectree2.models.evaluation.Feature.poly_area">
<span class="sig-name descname"><span class="pre">poly_area</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.Feature.poly_area" title="Link to this definition"></a></dt>
<dd><p>Calculates the area of the feature from scaled geojson.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="detectree2.models.evaluation.Feature.tree_height">
<span class="sig-name descname"><span class="pre">tree_height</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.Feature.tree_height" title="Link to this definition"></a></dt>
<dd><p>Crops the lidar tif to the features and calculates height.</p>
<p>Calculates the median height to account for
error at the boundaries. If no lidar file is inputted than the height is
given as 0</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="detectree2.models.evaluation.GeoFeature">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">GeoFeature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">number</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lidar_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">EPSG</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.GeoFeature" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Feature class to store.</p>
<p>Longer class information.</p>
<dl class="py method">
<dt class="sig sig-object py" id="detectree2.models.evaluation.GeoFeature.get_tuple_coords">
<span class="sig-name descname"><span class="pre">get_tuple_coords</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coords</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.GeoFeature.get_tuple_coords" title="Link to this definition"></a></dt>
<dd><p>Converts coordinates’ data structure from a list of lists to a list
of tuples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="detectree2.models.evaluation.GeoFeature.poly_area">
<span class="sig-name descname"><span class="pre">poly_area</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.GeoFeature.poly_area" title="Link to this definition"></a></dt>
<dd><p>Calculates the area of the feature from scaled geojson.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="detectree2.models.evaluation.GeoFeature.tree_height">
<span class="sig-name descname"><span class="pre">tree_height</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.GeoFeature.tree_height" title="Link to this definition"></a></dt>
<dd><p>Crops the lidar tif to the features and calculates height</p>
<p>Calculates the median height to account for
error at the boundaries. If no lidar file is inputted than the height is
given as 0</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.evaluation.f1_cal">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">f1_cal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">precision</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recall</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.f1_cal" title="Link to this definition"></a></dt>
<dd><p>Calculate the F1 score.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.evaluation.feat_threshold_tests">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">feat_threshold_tests</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_instance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conf_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">border_filter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tile_width</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.feat_threshold_tests" title="Link to this definition"></a></dt>
<dd><p>Tests completed to see if a feature should be considered valid.</p>
<p>Checks if the feature is above the confidence threshold if there is a confidence score available (only applies in
predicted crown case).  Filters out features with areas too small which are often crowns that are from an
adjacent tile that have a bit spilt over. Removes features within a border of the edge, border size is given by
border_filter proportion of the tile width.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.evaluation.feat_threshold_tests2">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">feat_threshold_tests2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_instance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conf_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">border_filter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tile_width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tile_origin</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.feat_threshold_tests2" title="Link to this definition"></a></dt>
<dd><p>Tests completed to see if a feature should be considered valid.</p>
<p>Checks if the feature is above the confidence threshold if there is a
confidence score available (only applies in predicted crown case).  Filters
out features with areas too small which are often crowns that are from an
adjacent tile that have a bit spilt over. Removes features within a border
of the edge, border size is given by border_filter proportion of the tile
width.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.evaluation.feats_height_filt">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">feats_height_filt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_feats</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_height</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_height</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.feats_height_filt" title="Link to this definition"></a></dt>
<dd><p>Stores the numbers of all the features between min and max height.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.evaluation.find_intersections">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">find_intersections</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_test_feats</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_pred_feats</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.find_intersections" title="Link to this definition"></a></dt>
<dd><p>Finds the greatest intersection between predicted and manual crowns and then updates objects.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.evaluation.get_epsg">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">get_epsg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.get_epsg" title="Link to this definition"></a></dt>
<dd><p>Splitting up the file name to get EPSG</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.evaluation.get_heights">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">get_heights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_feats</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_height</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_height</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.get_heights" title="Link to this definition"></a></dt>
<dd><p>Find the heights of the trees</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.evaluation.get_tile_origin">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">get_tile_origin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.get_tile_origin" title="Link to this definition"></a></dt>
<dd><p>Splitting up the file name to get tile origin</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.evaluation.get_tile_width">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">get_tile_width</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.get_tile_width" title="Link to this definition"></a></dt>
<dd><p>Split up the file name to get width and buffer then adding to get overall width.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.evaluation.initialise_feats">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">initialise_feats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">directory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lidar_filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lidar_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conf_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">border_filter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tile_width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">EPSG</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.initialise_feats" title="Link to this definition"></a></dt>
<dd><p>Creates a list of all the features as objects of the class.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.evaluation.initialise_feats2">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">initialise_feats2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">directory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lidar_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conf_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">border_filter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tile_width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tile_origin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsg</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.initialise_feats2" title="Link to this definition"></a></dt>
<dd><p>Creates a list of all the features as objects of the class.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.evaluation.positives_test">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">positives_test</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_test_feats</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_pred_feats</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_IoU</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_height</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_height</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.positives_test" title="Link to this definition"></a></dt>
<dd><p>Determines number of true postives, false positives and false negatives.</p>
<p>Store the numbers of all test features which have true positives arise.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.evaluation.prec_recall">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">prec_recall</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">total_tps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">total_fps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">total_fns</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.prec_recall" title="Link to this definition"></a></dt>
<dd><p>Calculate the precision and recall by standard formulas.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.evaluation.save_feats">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">save_feats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tile_directory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_feats</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.save_feats" title="Link to this definition"></a></dt>
<dd><p>Collating all the information for the features back into a geojson to save.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.evaluation.site_f1_score">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">site_f1_score</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tile_directory=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_directory=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pred_directory=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lidar_img=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">IoU_threshold=0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height_threshold=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area_fraction_limit=0.0005</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conf_threshold=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">border_filter=&lt;class</span> <span class="pre">'tuple'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scaling=&lt;class</span> <span class="pre">'list'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">EPSG=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save=False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.site_f1_score" title="Link to this definition"></a></dt>
<dd><p>Calculating all the intersections of shapes in a pair of files and the area of the corresponding polygons.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>tile_directory: path to the folder containing all of the tiles
test_directory: path to the folder containing just the test files
pred_directory: path to the folder containing the predictions and the reprojections
lidar_img: path to the lidar image of an entire region
IoU_threshold: minimum value of IoU such that the intersection can be considered a true positive
height_threshold: minimum height of the features to be considered
area_fraction_limit: proportion of the tile for which crowns with areas less than this will be ignored
conf_threshold: minimun confidence of a predicted feature so that it is considered
border_filter: bool of whether to remove border crowns, proportion of border to be used
in relation to tile size
scaling: x and y scaling used when tiling the image
EPSG: area code of tree location
save: bool to tell program whether the filtered crowns should be saved</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.evaluation.site_f1_score2">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.evaluation.</span></span><span class="sig-name descname"><span class="pre">site_f1_score2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tile_directory=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_directory=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pred_directory=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lidar_img=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">IoU_threshold=0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_height=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_height=100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area_threshold=25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conf_threshold=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">border_filter=&lt;class</span> <span class="pre">'tuple'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save=False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.evaluation.site_f1_score2" title="Link to this definition"></a></dt>
<dd><p>Calculating all the intersections of shapes in a pair of files and the
area of the corresponding polygons.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>tile_directory: path to the folder containing all of the tiles
test_directory: path to the folder containing just the test files
pred_directory: path to the folder containing the predictions and the reprojections
lidar_img: path to the lidar image of an entire region
IoU_threshold: minimum value of IoU such that the intersection can be considered a true positive
min_height: minimum height of the features to be considered
max_height: minimum height of the features to be considered
area_threshold: min crown area to consider in m^2
conf_threshold: minimun confidence of a predicted feature so that it is considered
border_filter: bool to remove border crowns, buffer in from border to be used (in m)
in relation to tile size
scaling: x and y scaling used when tiling the image
save: bool to tell program whether the filtered crowns should be saved</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-detectree2.models.models">
<span id="detectree2-models-models-module"></span><h2>detectree2.models.models module<a class="headerlink" href="#module-detectree2.models.models" title="Link to this heading"></a></h2>
</section>
<section id="module-detectree2.models.outputs">
<span id="detectree2-models-outputs-module"></span><h2>detectree2.models.outputs module<a class="headerlink" href="#module-detectree2.models.outputs" title="Link to this heading"></a></h2>
<p>Process and clean predictions.</p>
<p>Funtions to process model predictions into outputs for model evaluation and
mapping crowns in geographic space.</p>
<dl class="py class">
<dt class="sig sig-object py" id="detectree2.models.outputs.CRSType">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">CRSType</span></span><a class="headerlink" href="#detectree2.models.outputs.CRSType" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="detectree2.models.outputs.CRSType.properties">
<span class="sig-name descname"><span class="pre">properties</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#detectree2.models.outputs.CRSType.properties" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="detectree2.models.outputs.CRSType.type">
<span class="sig-name descname"><span class="pre">type</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#detectree2.models.outputs.CRSType.type" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="detectree2.models.outputs.GeoFile">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">GeoFile</span></span><a class="headerlink" href="#detectree2.models.outputs.GeoFile" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="detectree2.models.outputs.GeoFile.crs">
<span class="sig-name descname"><span class="pre">crs</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#detectree2.models.outputs.CRSType" title="detectree2.models.outputs.CRSType"><span class="pre">CRSType</span></a></em><a class="headerlink" href="#detectree2.models.outputs.GeoFile.crs" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="detectree2.models.outputs.GeoFile.features">
<span class="sig-name descname"><span class="pre">features</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#detectree2.models.outputs.GeoFile.features" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="detectree2.models.outputs.GeoFile.type">
<span class="sig-name descname"><span class="pre">type</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#detectree2.models.outputs.GeoFile.type" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.outputs.average_polygons">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">average_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">polygons</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_points</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">300</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.outputs.average_polygons" title="Link to this definition"></a></dt>
<dd><p>Average a set of polygons.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.outputs.box_filter">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">box_filter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.outputs.box_filter" title="Link to this definition"></a></dt>
<dd><p>Create a bounding box from a file name to filter edge crowns.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>filename: Name of the file.
shift: Number of meters to shift the size of the bounding box in by. This is to avoid edge crowns.</p>
</dd>
<dt>Returns:</dt><dd><p>gpd.GeoDataFrame: A GeoDataFrame containing the bounding box.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.outputs.box_make">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">box_make</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">minx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">miny</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">crs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.outputs.box_make" title="Link to this definition"></a></dt>
<dd><p>Generate bounding box from geographic specifications.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>minx: Minimum x coordinate.
miny: Minimum y coordinate.
width: Width of the tile.
buffer: Buffer around the tile.
crs: Coordinate reference system.
shift: Number of meters to shift the size of the bounding box in by. This is to avoid edge crowns.</p>
</dd>
<dt>Returns:</dt><dd><p>gpd.GeoDataFrame: A GeoDataFrame containing the bounding box.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.outputs.calc_iou">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">calc_iou</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shape1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.outputs.calc_iou" title="Link to this definition"></a></dt>
<dd><p>Calculate the IoU of two shapes.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.outputs.clean_crowns">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">clean_crowns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">crowns</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">GeoDataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iou_threshold</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">confidence</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area_threshold</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Confidence_score'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">GeoDataFrame</span></span></span><a class="headerlink" href="#detectree2.models.outputs.clean_crowns" title="Link to this definition"></a></dt>
<dd><p>Clean overlapping crowns.</p>
<p>Outputs can contain highly overlapping crowns including in the buffer region.
This function removes crowns with a high degree of overlap with others but a
lower Confidence Score.</p>
<dl>
<dt>Args:</dt><dd><p>crowns (gpd.GeoDataFrame): Crowns to be cleaned.
iou_threshold (float, optional): IoU threshold that determines whether crowns are overlapping.
confidence (float, optional): Minimum confidence score for crowns to be retained. Defaults to 0.2. Note that</p>
<blockquote>
<div><p>this should be adjusted to fit “field”.</p>
</div></blockquote>
<p>area_threshold (float, optional): Minimum area of crowns to be retained. Defaults to 1m2 (assuming UTM).
field (str): Field to used to prioritise selection of crowns. Defaults to “Confidence_score” but this should</p>
<blockquote>
<div><p>be changed to “Area” if using a model that outputs area.</p>
</div></blockquote>
</dd>
<dt>Returns:</dt><dd><p>gpd.GeoDataFrame: Cleaned crowns.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.outputs.clean_outputs">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">clean_outputs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">crowns</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">GeoDataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iou_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.7</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.outputs.clean_outputs" title="Link to this definition"></a></dt>
<dd><p>Clean predictions prior to accuracy assessment.</p>
<p>Outputs can contain highly overlapping crowns including in the buffer region.
This function removes crowns with a high degree of overlap with others but a
lower Confidence Score.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.outputs.clean_predictions">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">clean_predictions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">directory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iou_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.7</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.outputs.clean_predictions" title="Link to this definition"></a></dt>
<dd><p>Clean predictions prior to accuracy assessment.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.outputs.combine_and_average_polygons">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">combine_and_average_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gdfs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iou</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.9</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.outputs.combine_and_average_polygons" title="Link to this definition"></a></dt>
<dd><p>Combine and average polygons.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.outputs.filename_geoinfo">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">filename_geoinfo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.outputs.filename_geoinfo" title="Link to this definition"></a></dt>
<dd><p>Return geographic info of a tile from its filename.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.outputs.load_geopandas_dataframes">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">load_geopandas_dataframes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">folder</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.outputs.load_geopandas_dataframes" title="Link to this definition"></a></dt>
<dd><p>Load all GeoPackage files in a folder into a list of GeoDataFrames.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.outputs.normalize_polygon">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">normalize_polygon</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">polygon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_points</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.outputs.normalize_polygon" title="Link to this definition"></a></dt>
<dd><p>Normalize a polygon to a set number of points.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.outputs.polygon_from_mask">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">polygon_from_mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">masked_arr</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.outputs.polygon_from_mask" title="Link to this definition"></a></dt>
<dd><p>Convert RLE data from the output instances into Polygons.</p>
<p>Leads to a small about of data loss but does not affect performance?
<a class="reference external" href="https://github.com/hazirbas/coco-json-converter/blob/master/generate_coco_json.py">https://github.com/hazirbas/coco-json-converter/blob/master/generate_coco_json.py</a> &lt;– adapted from here</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.outputs.post_clean">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">post_clean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unclean_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">GeoDataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clean_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">GeoDataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iou_threshold</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Confidence_score'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">GeoDataFrame</span></span></span><a class="headerlink" href="#detectree2.models.outputs.post_clean" title="Link to this definition"></a></dt>
<dd><p>Fill in the gaps left by clean_crowns.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>unclean_df (gpd.GeoDataFrame): Unclean crowns.
clean_df (gpd.GeoDataFrame): Clean crowns.
iou_threshold (float, optional): IoU threshold that determines whether predictions are considered overlapping.
crowns are overlapping. Defaults to 0.3.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.outputs.project_to_geojson">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">project_to_geojson</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tiles_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pred_fold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_fold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">multi_class</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.outputs.project_to_geojson" title="Link to this definition"></a></dt>
<dd><p>Projects json predictions back in geographic space.</p>
<p>Takes a json and changes it to a geojson so it can overlay with orthomosaic. Another copy is produced to overlay
with PNGs.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>tiles_path (str): Path to the tiles folder.
pred_fold (str): Path to the predictions folder.
output_fold (str): Path to the output folder.</p>
</dd>
<dt>Returns:</dt><dd><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.outputs.stitch_crowns">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">stitch_crowns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">folder</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.outputs.stitch_crowns" title="Link to this definition"></a></dt>
<dd><p>Stitch together predicted crowns.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>folder: Path to folder containing geojson files.
shift: Number of meters to shift the size of the bounding box in by. This is to avoid edge crowns.</p>
</dd>
<dt>Returns:</dt><dd><p>gpd.GeoDataFrame: A GeoDataFrame containing all the crowns.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.outputs.to_eval_geojson">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.outputs.</span></span><span class="sig-name descname"><span class="pre">to_eval_geojson</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">directory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.outputs.to_eval_geojson" title="Link to this definition"></a></dt>
<dd><p>Converts predicted jsons to a geojson for evaluation (not mapping!).</p>
<p>Reproject the crowns to overlay with the cropped crowns and cropped pngs.
Another copy is produced to overlay with pngs.</p>
</dd></dl>

</section>
<section id="module-detectree2.models.predict">
<span id="detectree2-models-predict-module"></span><h2>detectree2.models.predict module<a class="headerlink" href="#module-detectree2.models.predict" title="Link to this heading"></a></h2>
<p>Generate predictions.</p>
<p>This module contains the code to generate predictions on tiled data.</p>
<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.predict.predict_on_data">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.predict.</span></span><span class="sig-name descname"><span class="pre">predict_on_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">directory:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'./'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_folder:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'predictions'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor=&lt;class</span> <span class="pre">'detectron2.engine.defaults.DefaultPredictor'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eval=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_predictions=0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.predict.predict_on_data" title="Link to this definition"></a></dt>
<dd><p>Make predictions on tiled data.</p>
<p>Predicts crowns for all png images present in a directory and outputs masks as jsons.</p>
</dd></dl>

</section>
<section id="module-detectree2.models.test">
<span id="detectree2-models-test-module"></span><h2>detectree2.models.test module<a class="headerlink" href="#module-detectree2.models.test" title="Link to this heading"></a></h2>
</section>
<section id="module-detectree2.models.train">
<span id="detectree2-models-train-module"></span><h2>detectree2.models.train module<a class="headerlink" href="#module-detectree2.models.train" title="Link to this heading"></a></h2>
<p>Train a model.</p>
<p>Classes and functions to train a model based on othomosaics and corresponding
manual crown data.</p>
<dl class="py class">
<dt class="sig sig-object py" id="detectree2.models.train.FlexibleDatasetMapper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">detectree2.models.train.</span></span><span class="sig-name descname"><span class="pre">FlexibleDatasetMapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cfg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_train</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">augmentations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.FlexibleDatasetMapper" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">DatasetMapper</span></code></p>
<p>A flexible dataset mapper that extends the standard DatasetMapper to handle
multi-band images and custom augmentations.</p>
<p>This class is designed to work with datasets that may contain images with
more than three channels (e.g., multispectral images) and allows for custom
augmentations to be applied. It also handles semantic segmentation data if
provided in the dataset.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>cfg (CfgNode): Configuration object containing dataset and model configurations.
is_train (bool): Flag indicating whether the mapper is being used for training. Default is True.
augmentations (list, optional): List of augmentations to be applied. Default is an empty list.</p>
</dd>
<dt>Attributes:</dt><dd><p>cfg (CfgNode): Stores the configuration object for later use.
is_train (bool): Indicates whether the mapper is in training mode.
logger (Logger): Logger instance for logging messages.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="detectree2.models.train.LossEvalHook">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">detectree2.models.train.</span></span><span class="sig-name descname"><span class="pre">LossEvalHook</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">eval_period</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_loader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patience</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.LossEvalHook" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">HookBase</span></code></p>
<p>A custom hook for evaluating loss during training and managing model checkpoints based on evaluation metrics.</p>
<p>This hook is designed to:
- Perform inference on a dataset similarly to an Evaluator.
- Calculate and log the loss metric during training.
- Save the best model checkpoint based on a specified evaluation metric (e.g., AP50).
- Implement early stopping if the evaluation metric does not improve over a specified number of evaluations.</p>
<dl class="simple">
<dt>Attributes:</dt><dd><p>_model: The model to evaluate.
_period: Number of iterations between evaluations.
_data_loader: The data loader used for evaluation.
patience: Number of evaluation periods to wait before early stopping.
iter: Tracks the number of evaluations since the last improvement in the evaluation metric.
max_ap: The best evaluation metric (e.g., AP50) achieved during training.
best_iter: The iteration at which the best evaluation metric was achieved.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="detectree2.models.train.LossEvalHook.after_step">
<span class="sig-name descname"><span class="pre">after_step</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.LossEvalHook.after_step" title="Link to this definition"></a></dt>
<dd><p>Hook to be called after each training iteration to evaluate the model and manage checkpoints.</p>
<ul class="simple">
<li><p>Evaluates the model at regular intervals.</p></li>
<li><p>Saves the best model checkpoint based on the AP50 metric.</p></li>
<li><p>Implements early stopping if the AP50 does not improve after a set number of evaluations.</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="detectree2.models.train.LossEvalHook.after_train">
<span class="sig-name descname"><span class="pre">after_train</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.LossEvalHook.after_train" title="Link to this definition"></a></dt>
<dd><p>Hook to be called after training is complete to load the best model checkpoint based on AP50.</p>
<ul class="simple">
<li><p>Selects and loads the model checkpoint with the best AP50.</p></li>
</ul>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="detectree2.models.train.MyTrainer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">detectree2.models.train.</span></span><span class="sig-name descname"><span class="pre">MyTrainer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cfg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patience</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.MyTrainer" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">DefaultTrainer</span></code></p>
<p>Custom Trainer class that extends the DefaultTrainer.</p>
<p>This trainer adds flexibility for handling different image types (e.g., RGB and multi-band images)
and custom training behavior, such as early stopping and specialized data augmentation strategies.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>cfg (CfgNode): Configuration object containing the model and dataset configurations.
patience (int): Number of evaluation periods to wait for improvement before early stopping.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="detectree2.models.train.MyTrainer.build_evaluator">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">build_evaluator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cfg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_folder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.MyTrainer.build_evaluator" title="Link to this definition"></a></dt>
<dd><p>Build the evaluator for the model.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>cfg (CfgNode): Configuration object.
dataset_name (str): Name of the dataset to evaluate.
output_folder (str, optional): Directory to save evaluation results. Defaults to “eval”.</p>
</dd>
<dt>Returns:</dt><dd><p>COCOEvaluator: An evaluator for COCO-style datasets.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="detectree2.models.train.MyTrainer.build_hooks">
<span class="sig-name descname"><span class="pre">build_hooks</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.MyTrainer.build_hooks" title="Link to this definition"></a></dt>
<dd><p>Build the training hooks, including the custom LossEvalHook.</p>
<p>This method adds a custom hook for evaluating the model’s loss during training, with support for
early stopping based on the AP50 metric.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>list: A list of hooks to be used during training.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="detectree2.models.train.MyTrainer.build_test_loader">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">build_test_loader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cfg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.MyTrainer.build_test_loader" title="Link to this definition"></a></dt>
<dd><p>Build the test data loader.</p>
<p>This method configures the data loader for evaluation, using the FlexibleDatasetMapper
to handle custom augmentations and image types.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>cfg (CfgNode): Configuration object.
dataset_name (str): Name of the dataset to load for testing.</p>
</dd>
<dt>Returns:</dt><dd><p>DataLoader: A data loader for the test dataset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="detectree2.models.train.MyTrainer.build_train_loader">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">build_train_loader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cfg</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.MyTrainer.build_train_loader" title="Link to this definition"></a></dt>
<dd><p>Build the training data loader with support for custom augmentations and image types.</p>
<p>This method configures the data loader to apply specific augmentations depending on the image mode
(RGB or multi-band) and resize strategy defined in the configuration.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>cfg (CfgNode): Configuration object.</p>
</dd>
<dt>Returns:</dt><dd><p>DataLoader: A data loader for the training dataset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="detectree2.models.train.MyTrainer.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.MyTrainer.train" title="Link to this definition"></a></dt>
<dd><p>Run the training loop.</p>
<p>This method overrides the DefaultTrainer’s train method to include early stopping and
custom logging of Average Precision (AP) metrics.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>OrderedDict: Results from evaluation, if evaluation is enabled. Otherwise, None.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.train.combine_dicts">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.train.</span></span><span class="sig-name descname"><span class="pre">combine_dicts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">root_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'train'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_mapping</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#detectree2.models.train.combine_dicts" title="Link to this definition"></a></dt>
<dd><p>Combine dictionaries from different directories based on the specified mode.</p>
<p>This function aggregates tree dictionaries from multiple directories within a root directory.
Depending on the mode, it either combines dictionaries from all directories,
all except a specified validation directory, or only from the validation directory.</p>
<dl>
<dt>Args:</dt><dd><p>root_dir (str): The root directory containing subdirectories with tree dictionaries.
val_dir (int): The index (1-based) of the validation directory to exclude or use depending on the mode.
mode (str, optional): The mode of operation. Can be “train”, “val”, or “full”.</p>
<blockquote>
<div><p>“train” excludes the validation directory,
“val” includes only the validation directory,
and “full” includes all directories. Defaults to “train”.</p>
</div></blockquote>
<p>class_mapping: A dictionary mapping class labels to category indices (optional).</p>
</dd>
<dt>Returns:</dt><dd><p>List of combined dictionaries from the specified directories.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.train.get_classes">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.train.</span></span><span class="sig-name descname"><span class="pre">get_classes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">out_dir</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.get_classes" title="Link to this definition"></a></dt>
<dd><p>Function that will read the classes that are recorded during tiling.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>out_dir: directory where classes.txt is located</p>
</dd>
<dt>Returns:</dt><dd><p>list of classes</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.train.get_filenames">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.train.</span></span><span class="sig-name descname"><span class="pre">get_filenames</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">directory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.get_filenames" title="Link to this definition"></a></dt>
<dd><p>Get the file names if no geojson is present.</p>
<p>Allows for predictions where no delinations have been manually produced.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>directory (str): directory of images to be predicted on</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.train.get_latest_model_path">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.train.</span></span><span class="sig-name descname"><span class="pre">get_latest_model_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#detectree2.models.train.get_latest_model_path" title="Link to this definition"></a></dt>
<dd><p>Find the model file with the highest index in the specified output directory.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>output_dir (str): The directory where the model files are stored.</p>
</dd>
<dt>Returns:</dt><dd><p>str: The path to the model file with the highest index.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.train.get_tree_dicts">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.train.</span></span><span class="sig-name descname"><span class="pre">get_tree_dicts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">directory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_mapping</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#detectree2.models.train.get_tree_dicts" title="Link to this definition"></a></dt>
<dd><p>Get the tree dictionaries.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>directory: Path to directory
classes: List of classes to include
classes_at: Signifies which column (if any) corresponds to the class labels</p>
</dd>
<dt>Returns:</dt><dd><p>List of dictionaries corresponding to segmentations of trees. Each dictionary includes
bounding box around tree and points tracing a polygon around a tree.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.train.load_json_arr">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.train.</span></span><span class="sig-name descname"><span class="pre">load_json_arr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">json_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.load_json_arr" title="Link to this definition"></a></dt>
<dd><p>Load json array.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>json_path: path to json file</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.train.modify_conv1_weights">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.train.</span></span><span class="sig-name descname"><span class="pre">modify_conv1_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_input_channels</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.modify_conv1_weights" title="Link to this definition"></a></dt>
<dd><p>Modify the weights of the first convolutional layer (conv1) to accommodate a different number of input channels.</p>
<p>This function adjusts the weights of the <cite>conv1</cite> layer in the model’s backbone to support a custom number
of input channels. It creates a new weight tensor with the desired number of input channels,
and initializes it by repeating the weights of the original channels.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>model (torch.nn.Module): The model containing the convolutional layer to modify.
num_input_channels (int): The number of input channels for the new conv1 layer.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.train.predictions_on_data">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.train.</span></span><span class="sig-name descname"><span class="pre">predictions_on_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">directory=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor=&lt;class</span> <span class="pre">'detectron2.engine.defaults.DefaultTrainer'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trees_metadata=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale=1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">geos_exist=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_predictions=0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.predictions_on_data" title="Link to this definition"></a></dt>
<dd><p>Prediction produced from a test folder and outputted to predictions folder.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>directory: directory containing test data
predictor: predictor object
trees_metadata: metadata for trees
save: boolean to save predictions
scale: scale of image
geos_exist: boolean to determine if geojson files exist
num_predictions: number of predictions to make</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.train.register_test_data">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.train.</span></span><span class="sig-name descname"><span class="pre">register_test_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test_location</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tree'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.register_test_data" title="Link to this definition"></a></dt>
<dd><p>Register data for testing.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>test_location: directory containing test data
name: string to name data</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.train.register_train_data">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.train.</span></span><span class="sig-name descname"><span class="pre">register_train_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_location</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'tree'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_fold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_mapping_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.register_train_data" title="Link to this definition"></a></dt>
<dd><p>Register data for training and (optionally) validation.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>train_location: Directory containing training folds.
name: Name to register the dataset.
val_fold: Validation fold index (optional).
class_mapping_file: Path to the class mapping file (json or pickle).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.train.remove_registered_data">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.train.</span></span><span class="sig-name descname"><span class="pre">remove_registered_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tree'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.remove_registered_data" title="Link to this definition"></a></dt>
<dd><p>Remove registered data from catalog.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>name: string of named registered data</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="detectree2.models.train.setup_cfg">
<span class="sig-prename descclassname"><span class="pre">detectree2.models.train.</span></span><span class="sig-name descname"><span class="pre">setup_cfg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'COCO-InstanceSegmentation/mask_rcnn_R_101_FPN_3x.yaml'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trains</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">('trees_train',)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tests</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">('trees_val',)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">workers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ims_per_batch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backbone_freeze</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">warm_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">120</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momentum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.9</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size_per_im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1024</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_lr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0003389</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_decay</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eval_period</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./train_outputs'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'fixed'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imgmode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'rgb'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_bands</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_mapping_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#detectree2.models.train.setup_cfg" title="Link to this definition"></a></dt>
<dd><p>Set up config object # noqa: D417.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>base_model: base pre-trained model from detectron2 model_zoo
trains: names of registered data to use for training
tests: names of registered data to use for evaluating models
update_model: updated pre-trained model from detectree2 model_garden
workers: number of workers for dataloader
ims_per_batch: number of images per batch
gamma: gamma for learning rate scheduler
backbone_freeze: backbone layer to freeze
warm_iter: number of iterations for warmup
momentum: momentum for optimizer
batch_size_per_im: batch size per image
base_lr: base learning rate
weight_decay: weight decay for optimizer
max_iter: maximum number of iterations
num_classes: number of classes
eval_period: number of iterations between evaluations
out_dir: directory to save outputs
resize: resize strategy for images
imgmode: image mode (rgb or multispectral)
num_bands: number of bands in the image
class_mapping_file: path to class mapping file</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-detectree2.models.train_tune">
<span id="detectree2-models-train-tune-module"></span><h2>detectree2.models.train_tune module<a class="headerlink" href="#module-detectree2.models.train_tune" title="Link to this heading"></a></h2>
</section>
<section id="module-detectree2.models">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-detectree2.models" title="Link to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, James Ball.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>